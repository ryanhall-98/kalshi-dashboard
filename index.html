<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalshi Trading Bot ‚Äî Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0e17;
  --surface: #111827;
  --surface2: #1a2235;
  --border: #1e2a3a;
  --text: #e2e8f0;
  --text2: #8896ab;
  --green: #22c55e;
  --green-bg: rgba(34,197,94,0.1);
  --red: #ef4444;
  --red-bg: rgba(239,68,68,0.1);
  --blue: #3b82f6;
  --blue-bg: rgba(59,130,246,0.1);
  --yellow: #eab308;
  --yellow-bg: rgba(234,179,8,0.1);
  --purple: #a855f7;
  --purple-bg: rgba(168,85,247,0.1);
  --mono: 'JetBrains Mono', monospace;
  --sans: 'DM Sans', sans-serif;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--text); font-family:var(--sans); min-height:100vh; }
.app { max-width:960px; margin:0 auto; padding:16px; }

/* Header */
.header { display:flex; align-items:center; justify-content:space-between; padding:16px 0; border-bottom:1px solid var(--border); margin-bottom:20px; }
.header h1 { font-family:var(--mono); font-size:18px; font-weight:700; letter-spacing:-0.5px; }
.header h1 span { color:var(--blue); }
.bot-status { display:flex; align-items:center; gap:8px; font-size:13px; color:var(--text2); font-family:var(--mono); }
.status-dot { width:8px; height:8px; border-radius:50%; animation: pulse 2s infinite; }
.status-dot.on { background:var(--green); box-shadow:0 0 8px var(--green); }
.status-dot.off { background:var(--red); box-shadow:0 0 8px var(--red); animation:none; }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.4} }

/* Nav Tabs */
.tabs { display:flex; gap:2px; background:var(--surface); border-radius:10px; padding:3px; margin-bottom:20px; }
.tab { flex:1; padding:10px; text-align:center; font-size:13px; font-weight:500; border-radius:8px; cursor:pointer; color:var(--text2); transition:all 0.2s; }
.tab:hover { color:var(--text); }
.tab.active { background:var(--surface2); color:var(--text); box-shadow:0 1px 3px rgba(0,0,0,0.3); }
.panel { display:none; }
.panel.active { display:block; }

/* Stats Grid */
.stats { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-bottom:20px; }
@media(min-width:600px) { .stats { grid-template-columns:repeat(4,1fr); } }
.stat { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:16px; }
.stat-label { font-size:11px; text-transform:uppercase; letter-spacing:1px; color:var(--text2); margin-bottom:6px; }
.stat-value { font-family:var(--mono); font-size:22px; font-weight:700; }
.stat-value.green { color:var(--green); }
.stat-value.red { color:var(--red); }
.stat-sub { font-size:11px; color:var(--text2); margin-top:4px; font-family:var(--mono); }

/* Big PnL */
.pnl-hero { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:24px; text-align:center; margin-bottom:20px; }
.pnl-amount { font-family:var(--mono); font-size:42px; font-weight:700; letter-spacing:-1px; }
.pnl-label { font-size:12px; color:var(--text2); margin-top:4px; text-transform:uppercase; letter-spacing:1px; }

/* Chart */
.chart-box { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:16px; margin-bottom:20px; }
.chart-title { font-size:13px; color:var(--text2); margin-bottom:12px; }
.chart-canvas { width:100%; height:180px; }

/* Trade Table */
.trades-section { background:var(--surface); border:1px solid var(--border); border-radius:10px; overflow:hidden; margin-bottom:20px; }
.trades-header { padding:14px 16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.trades-header h3 { font-size:14px; font-weight:600; }
.trade-row { display:grid; grid-template-columns:1fr 70px 70px 70px; gap:8px; padding:12px 16px; border-bottom:1px solid var(--border); align-items:center; font-size:13px; }
.trade-row:last-child { border-bottom:none; }
.trade-row.header { font-size:11px; color:var(--text2); text-transform:uppercase; letter-spacing:0.5px; }
.trade-market { font-family:var(--mono); font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.trade-tag { display:inline-block; padding:2px 8px; border-radius:4px; font-size:11px; font-weight:600; font-family:var(--mono); }
.trade-tag.win { background:var(--green-bg); color:var(--green); }
.trade-tag.loss { background:var(--red-bg); color:var(--red); }
.trade-tag.pending { background:var(--yellow-bg); color:var(--yellow); }
.trade-pnl { font-family:var(--mono); font-weight:600; text-align:right; }

/* Sync Bar */
.sync-bar { display:flex; gap:8px; margin-bottom:20px; }
.sync-btn { background:var(--surface2); border:1px solid var(--border); color:var(--text); padding:10px 16px; border-radius:8px; cursor:pointer; font-size:13px; font-family:var(--sans); transition:all 0.15s; }
.sync-btn:hover { background:var(--border); }
.sync-btn.primary { background:var(--blue); border-color:var(--blue); }
.sync-btn.primary:hover { background:#2563eb; }

/* Settings Panel */
.settings-group { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:20px; margin-bottom:16px; }
.settings-group h3 { font-size:14px; font-weight:600; margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid var(--border); }
.setting-row { margin-bottom:20px; }
.setting-row:last-child { margin-bottom:0; }
.setting-label { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.setting-label span { font-size:13px; }
.setting-label .val { font-family:var(--mono); font-weight:700; color:var(--blue); font-size:15px; }
.setting-hint { font-size:11px; color:var(--text2); margin-top:4px; }
.rec-badge { font-size:10px; background:var(--purple-bg); color:var(--purple); padding:2px 6px; border-radius:4px; font-family:var(--mono); font-weight:600; }

/* Range Slider */
.slider-wrap { position:relative; padding:0 0 4px; }
input[type=range] { -webkit-appearance:none; width:100%; height:6px; border-radius:3px; background:var(--surface2); outline:none; }
input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:18px; height:18px; border-radius:50%; background:var(--blue); cursor:pointer; box-shadow:0 0 6px rgba(59,130,246,0.4); }
.rec-marker { position:absolute; top:-2px; width:2px; height:10px; background:var(--purple); border-radius:1px; pointer-events:none; }

/* Toggle */
.toggle-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid var(--border); }
.toggle-row:last-child { border-bottom:none; }
.toggle-label { font-size:13px; }
.toggle { position:relative; width:44px; height:24px; cursor:pointer; }
.toggle input { opacity:0; width:0; height:0; }
.toggle .slider { position:absolute; inset:0; background:var(--surface2); border-radius:12px; transition:0.2s; border:1px solid var(--border); }
.toggle .slider:before { content:''; position:absolute; width:18px; height:18px; border-radius:50%; background:var(--text2); left:2px; top:2px; transition:0.2s; }
.toggle input:checked + .slider { background:var(--blue); border-color:var(--blue); }
.toggle input:checked + .slider:before { transform:translateX(20px); background:#fff; }

/* Kill Switch */
.kill-switch { display:flex; align-items:center; justify-content:space-between; background:var(--surface); border:2px solid var(--border); border-radius:10px; padding:16px 20px; margin-bottom:16px; }
.kill-switch.on { border-color:var(--green); }
.kill-switch.off { border-color:var(--red); }
.kill-label { font-size:15px; font-weight:600; }
.kill-status { font-family:var(--mono); font-size:13px; }

/* Config output */
.config-output { background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:16px; font-family:var(--mono); font-size:12px; color:var(--text2); white-space:pre; overflow-x:auto; margin-top:16px; line-height:1.6; }
.copy-config { margin-top:10px; }

/* Sync modal */
.modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:100; align-items:center; justify-content:center; }
.modal-overlay.show { display:flex; }
.modal { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:24px; max-width:500px; width:90%; }
.modal h3 { margin-bottom:12px; }
.modal textarea { width:100%; height:200px; background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:12px; font-family:var(--mono); font-size:12px; color:var(--text); resize:none; }
.modal-actions { display:flex; gap:8px; margin-top:12px; justify-content:flex-end; }
</style>
</head>
<body>
<div class="app">

<!-- Header -->
<div class="header">
  <h1>KALSHI <span>BOT</span></h1>
  <div class="bot-status">
    <div class="status-dot on" id="statusDot"></div>
    <span id="statusText">SIMULATION</span>
  </div>
</div>

<!-- Tabs -->
<div class="tabs">
  <div class="tab active" data-tab="overview">Overview</div>
  <div class="tab" data-tab="trades">Trades</div>
  <div class="tab" data-tab="settings">‚öô Settings</div>
</div>

<!-- OVERVIEW PANEL -->
<div class="panel active" id="overview">
  <div class="pnl-hero">
    <div class="pnl-amount" id="pnlAmount">$0.00</div>
    <div class="pnl-label">Simulated P&L</div>
  </div>

  <div class="stats">
    <div class="stat">
      <div class="stat-label">Win Rate</div>
      <div class="stat-value" id="winRate">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-label">Total Trades</div>
      <div class="stat-value" id="totalTrades">0</div>
    </div>
    <div class="stat">
      <div class="stat-label">Pending</div>
      <div class="stat-value" id="pendingCount">0</div>
    </div>
    <div class="stat">
      <div class="stat-label">Total Invested</div>
      <div class="stat-value" id="totalInvested">$0</div>
    </div>
  </div>

  <div class="chart-box">
    <div class="chart-title">Cumulative P&L</div>
    <canvas class="chart-canvas" id="pnlChart"></canvas>
  </div>

  <div class="sync-bar">
    <button class="sync-btn primary" onclick="openSyncModal()">‚¨Ü Sync Trades</button>
    <button class="sync-btn" onclick="exportData()">‚¨á Export</button>
    <button class="sync-btn" onclick="clearData()">‚úï Clear</button>
  </div>
</div>

<!-- TRADES PANEL -->
<div class="panel" id="trades">
  <div class="trades-section">
    <div class="trades-header">
      <h3>All Trades</h3>
    </div>
    <div class="trade-row header">
      <span>Market</span><span>Cost</span><span>Result</span><span style="text-align:right">P&L</span>
    </div>
    <div id="tradesList"></div>
  </div>
</div>

<!-- SETTINGS PANEL -->
<div class="panel" id="settings">
  <!-- Kill Switch -->
  <div class="kill-switch on" id="killSwitch">
    <div>
      <div class="kill-label">Bot Enabled</div>
      <div class="kill-status" id="killStatus">Trading active</div>
    </div>
    <label class="toggle">
      <input type="checkbox" id="botEnabled" checked onchange="updateKillSwitch()">
      <span class="slider"></span>
    </label>
  </div>

  <!-- Trading Limits -->
  <div class="settings-group">
    <h3>Trading Limits</h3>

    <div class="setting-row">
      <div class="setting-label">
        <span>Daily Spend Cap</span>
        <span class="val" id="dailyLimitVal">$25</span>
      </div>
      <div class="slider-wrap">
        <input type="range" min="5" max="200" value="25" step="5" id="dailyLimit" oninput="updateSlider('dailyLimit','$')">
        <div class="rec-marker" style="left:calc((25 - 5) / (200 - 5) * 100%)"></div>
      </div>
      <div class="setting-hint">Recommended: <span class="rec-badge">$25</span> ‚Äî Max total spent per day across all trades</div>
    </div>

    <div class="setting-row">
      <div class="setting-label">
        <span>Per Trade Size</span>
        <span class="val" id="perTradeVal">$5</span>
      </div>
      <div class="slider-wrap">
        <input type="range" min="1" max="50" value="5" step="1" id="perTrade" oninput="updateSlider('perTrade','$')">
        <div class="rec-marker" style="left:calc((5 - 1) / (50 - 1) * 100%)"></div>
      </div>
      <div class="setting-hint">Recommended: <span class="rec-badge">$5</span> ‚Äî Amount risked on each individual trade</div>
    </div>

    <div class="setting-row">
      <div class="setting-label">
        <span>Max Trades Per Day</span>
        <span class="val" id="maxTradesVal">6</span>
      </div>
      <div class="slider-wrap">
        <input type="range" min="1" max="20" value="6" step="1" id="maxTrades" oninput="updateSlider('maxTrades','')">
        <div class="rec-marker" style="left:calc((6 - 1) / (20 - 1) * 100%)"></div>
      </div>
      <div class="setting-hint">Recommended: <span class="rec-badge">6</span> ‚Äî Prevents over-trading on a single day</div>
    </div>
  </div>

  <!-- AI Thresholds -->
  <div class="settings-group">
    <h3>AI Thresholds</h3>

    <div class="setting-row">
      <div class="setting-label">
        <span>Min Confidence</span>
        <span class="val" id="minConfVal">70%</span>
      </div>
      <div class="slider-wrap">
        <input type="range" min="30" max="95" value="70" step="5" id="minConf" oninput="updateSlider('minConf','%')">
        <div class="rec-marker" style="left:calc((70 - 30) / (95 - 30) * 100%)"></div>
      </div>
      <div class="setting-hint">Recommended: <span class="rec-badge">70%</span> ‚Äî Claude must be this confident to trigger a trade</div>
    </div>

    <div class="setting-row">
      <div class="setting-label">
        <span>Min Edge</span>
        <span class="val" id="minEdgeVal">10%</span>
      </div>
      <div class="slider-wrap">
        <input type="range" min="3" max="30" value="10" step="1" id="minEdge" oninput="updateSlider('minEdge','%')">
        <div class="rec-marker" style="left:calc((10 - 3) / (30 - 3) * 100%)"></div>
      </div>
      <div class="setting-hint">Recommended: <span class="rec-badge">10%</span> ‚Äî Gap between Claude's probability and market price needed to trade</div>
    </div>
  </div>

  <!-- Markets -->
  <div class="settings-group">
    <h3>Enabled Markets</h3>
    <div class="toggle-row">
      <span class="toggle-label">üå§ Weather</span>
      <label class="toggle"><input type="checkbox" id="mktWeather" checked><span class="slider"></span></label>
    </div>
    <div class="toggle-row">
      <span class="toggle-label">üèõ Politics</span>
      <label class="toggle"><input type="checkbox" id="mktPolitics"><span class="slider"></span></label>
    </div>
    <div class="toggle-row">
      <span class="toggle-label">‚Çø Crypto</span>
      <label class="toggle"><input type="checkbox" id="mktCrypto"><span class="slider"></span></label>
    </div>
    <div class="toggle-row">
      <span class="toggle-label">üìà Finance</span>
      <label class="toggle"><input type="checkbox" id="mktFinance"><span class="slider"></span></label>
    </div>
  </div>

  <!-- Safety -->
  <div class="settings-group">
    <h3>Safety</h3>
    <div class="toggle-row">
      <span class="toggle-label">Conflict Detection <span style="color:var(--text2);font-size:11px">‚Äî prevents contradictory bets</span></span>
      <label class="toggle"><input type="checkbox" id="conflictDetect" checked><span class="slider"></span></label>
    </div>
    <div class="toggle-row">
      <span class="toggle-label">Duplicate Prevention <span style="color:var(--text2);font-size:11px">‚Äî prevents same ticker twice</span></span>
      <label class="toggle"><input type="checkbox" id="dupePrevent" checked><span class="slider"></span></label>
    </div>
  </div>

  <!-- Generated Config -->
  <div class="settings-group">
    <h3>Generated Config</h3>
    <p style="font-size:12px;color:var(--text2);margin-bottom:10px;">Copy this config and push to your GitHub repo. The bot pulls it before each cycle.</p>
    <div class="config-output" id="configOutput"></div>
    <div style="display:flex;gap:8px;margin-top:10px;">
      <button class="sync-btn primary" onclick="copyConfig()">üìã Copy Config</button>
      <button class="sync-btn" onclick="copySshCommand()">üìã Copy SSH Push Command</button>
    </div>
  </div>
</div>

</div>

<!-- Sync Modal -->
<div class="modal-overlay" id="syncModal">
  <div class="modal">
    <h3>Sync Trade Data</h3>
    <p style="font-size:12px;color:var(--text2);margin-bottom:10px;">Run this on your Mac, then paste the output below:</p>
    <div class="config-output" style="margin-bottom:12px;font-size:11px;">ssh root@174.138.84.53 'cat /root/polymarket-ai-bot/data/trades.json'</div>
    <textarea id="syncInput" placeholder="Paste trades.json content here..."></textarea>
    <div class="modal-actions">
      <button class="sync-btn" onclick="closeSyncModal()">Cancel</button>
      <button class="sync-btn primary" onclick="importTrades()">Import</button>
    </div>
  </div>
</div>

<script>
// ===== TRADE DATA =====
// Real trades from VPS as of Feb 11, 2026
const DEFAULT_TRADES = [
  {id:1,ticker:"KXHIGHNY-26FEB12-B38.5",market:"NYC High 38-39¬∞F Feb 12",side:"YES",price:0.12,qty:32,cost:3.84,potential:28.16,edge:0.08,confidence:0.75,ts:"2026-02-11T20:20:14",result:"loss",pnl:-3.84},
  {id:2,ticker:"KXHIGHNY-26FEB12-B34.5",market:"NYC High 34-35¬∞F Feb 12",side:"YES",price:0.30,qty:21,cost:6.30,potential:14.70,edge:0.15,confidence:0.80,ts:"2026-02-11T20:20:14",result:"win",pnl:14.70},
  {id:3,ticker:"KXHIGHCHI-26FEB12-T38",market:"Chicago High <38¬∞F Feb 12",side:"YES",price:0.22,qty:28,cost:6.16,potential:21.84,edge:0.13,confidence:0.75,ts:"2026-02-11T20:20:14",result:"loss",pnl:-6.16},
  {id:4,ticker:"KXHIGHCHI-26FEB12-B42.5",market:"Chicago High 42-43¬∞F Feb 12",side:"YES",price:0.12,qty:52,cost:6.24,potential:45.76,edge:0.13,confidence:0.70,ts:"2026-02-11T20:20:14",result:"loss",pnl:-6.24},
  {id:5,ticker:"KXHIGHNY-26FEB12-B38.5",market:"NYC High 38-39¬∞F Feb 12 (dup)",side:"YES",price:0.12,qty:32,cost:3.84,potential:28.16,edge:0.08,confidence:0.75,ts:"2026-02-11T20:22:14",result:"loss",pnl:-3.84},
  {id:6,ticker:"KXHIGHNY-26FEB12-B34.5",market:"NYC High 34-35¬∞F Feb 12 (dup)",side:"YES",price:0.30,qty:21,cost:6.30,potential:14.70,edge:0.15,confidence:0.80,ts:"2026-02-11T20:22:14",result:"win",pnl:14.70},
  {id:7,ticker:"KXHIGHCHI-26FEB12-T38",market:"Chicago High <38¬∞F Feb 12 (dup)",side:"YES",price:0.22,qty:28,cost:6.16,potential:21.84,edge:0.13,confidence:0.75,ts:"2026-02-11T20:22:14",result:"loss",pnl:-6.16},
  {id:8,ticker:"KXHIGHNY-26FEB12-B38.5",market:"NYC High 38-39¬∞F Feb 12",side:"YES",price:0.12,qty:32,cost:3.84,potential:28.16,edge:0.08,confidence:0.75,ts:"2026-02-12T01:20:14",result:"loss",pnl:-3.84},
  {id:9,ticker:"KXHIGHNY-26FEB12-B34.5",market:"NYC High 34-35¬∞F Feb 12",side:"YES",price:0.30,qty:21,cost:6.30,potential:14.70,edge:0.15,confidence:0.80,ts:"2026-02-12T01:20:14",result:"win",pnl:14.70},
  {id:10,ticker:"KXHIGHCHI-26FEB12-T38",market:"Chicago High <38¬∞F Feb 12",side:"YES",price:0.22,qty:28,cost:6.16,potential:21.84,edge:0.13,confidence:0.75,ts:"2026-02-12T01:20:14",result:"loss",pnl:-6.16},
  {id:11,ticker:"KXHIGHCHI-26FEB12-B42.5",market:"Chicago High 42-43¬∞F Feb 12",side:"YES",price:0.12,qty:52,cost:6.24,potential:45.76,edge:0.13,confidence:0.70,ts:"2026-02-12T01:20:14",result:"loss",pnl:-6.24},
  {id:12,ticker:"KXHIGHNY-26FEB12-B38.5",market:"NYC High 38-39¬∞F Feb 12",side:"YES",price:0.12,qty:32,cost:3.84,potential:28.16,edge:0.08,confidence:0.75,ts:"2026-02-12T01:22:14",result:"loss",pnl:-3.84},
  {id:13,ticker:"KXHIGHNY-26FEB12-B34.5",market:"NYC High 34-35¬∞F Feb 12",side:"YES",price:0.30,qty:21,cost:6.30,potential:14.70,edge:0.15,confidence:0.80,ts:"2026-02-12T01:22:14",result:"win",pnl:14.70},
  {id:14,ticker:"KXHIGHCHI-26FEB12-T38",market:"Chicago High <38¬∞F Feb 12",side:"YES",price:0.22,qty:28,cost:6.16,potential:21.84,edge:0.13,confidence:0.75,ts:"2026-02-12T01:22:14",result:"loss",pnl:-6.16},
];

// ===== STATE =====
let trades = JSON.parse(localStorage.getItem('kalshi_trades') || 'null') || DEFAULT_TRADES;

function saveTrades() { localStorage.setItem('kalshi_trades', JSON.stringify(trades)); }

// ===== TABS =====
document.querySelectorAll('.tab').forEach(t => {
  t.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    document.getElementById(t.dataset.tab).classList.add('active');
    if (t.dataset.tab === 'settings') generateConfig();
  });
});

// ===== OVERVIEW =====
function renderOverview() {
  const resolved = trades.filter(t => t.result === 'win' || t.result === 'loss');
  const pending = trades.filter(t => t.result === 'pending');
  const wins = resolved.filter(t => t.result === 'win');
  const totalPnl = resolved.reduce((s, t) => s + (t.pnl || 0), 0);
  const totalCost = trades.reduce((s, t) => s + (t.cost || 0), 0);

  const pnlEl = document.getElementById('pnlAmount');
  pnlEl.textContent = (totalPnl >= 0 ? '+' : '') + '$' + totalPnl.toFixed(2);
  pnlEl.className = 'pnl-amount ' + (totalPnl >= 0 ? 'green' : 'red');

  document.getElementById('winRate').textContent = resolved.length ? Math.round(wins.length / resolved.length * 100) + '%' : '‚Äî';
  document.getElementById('winRate').className = 'stat-value ' + (wins.length / resolved.length >= 0.5 ? 'green' : 'red');
  document.getElementById('totalTrades').textContent = trades.length;
  document.getElementById('pendingCount').textContent = pending.length;
  document.getElementById('totalInvested').textContent = '$' + totalCost.toFixed(2);

  drawChart(resolved);
}

function drawChart(resolved) {
  const canvas = document.getElementById('pnlChart');
  const ctx = canvas.getContext('2d');
  canvas.width = canvas.offsetWidth * 2;
  canvas.height = canvas.offsetHeight * 2;
  ctx.scale(2, 2);
  const W = canvas.offsetWidth, H = canvas.offsetHeight;
  ctx.clearRect(0, 0, W, H);

  if (resolved.length < 2) {
    ctx.fillStyle = '#8896ab';
    ctx.font = '13px DM Sans';
    ctx.textAlign = 'center';
    ctx.fillText('Need more resolved trades for chart', W/2, H/2);
    return;
  }

  let cum = 0;
  const pts = resolved.map(t => { cum += t.pnl; return cum; });
  const mn = Math.min(0, ...pts), mx = Math.max(0, ...pts);
  const range = mx - mn || 1;
  const pad = 20;

  // Zero line
  const zeroY = pad + (mx / range) * (H - 2*pad);
  ctx.strokeStyle = '#1e2a3a';
  ctx.lineWidth = 1;
  ctx.setLineDash([4,4]);
  ctx.beginPath();
  ctx.moveTo(pad, zeroY);
  ctx.lineTo(W-pad, zeroY);
  ctx.stroke();
  ctx.setLineDash([]);

  // PnL line
  ctx.beginPath();
  pts.forEach((p, i) => {
    const x = pad + (i / (pts.length-1)) * (W - 2*pad);
    const y = pad + ((mx - p) / range) * (H - 2*pad);
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });
  const lastPnl = pts[pts.length-1];
  ctx.strokeStyle = lastPnl >= 0 ? '#22c55e' : '#ef4444';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Fill
  const lastX = pad + (1) * (W - 2*pad);
  ctx.lineTo(lastX, zeroY);
  ctx.lineTo(pad, zeroY);
  ctx.closePath();
  ctx.fillStyle = lastPnl >= 0 ? 'rgba(34,197,94,0.08)' : 'rgba(239,68,68,0.08)';
  ctx.fill();

  // Dots
  pts.forEach((p, i) => {
    const x = pad + (i / (pts.length-1)) * (W - 2*pad);
    const y = pad + ((mx - p) / range) * (H - 2*pad);
    ctx.beginPath();
    ctx.arc(x, y, 3, 0, Math.PI*2);
    ctx.fillStyle = p >= 0 ? '#22c55e' : '#ef4444';
    ctx.fill();
  });
}

// ===== TRADES LIST =====
function renderTrades() {
  const list = document.getElementById('tradesList');
  list.innerHTML = '';
  const sorted = [...trades].reverse();
  sorted.forEach(t => {
    const row = document.createElement('div');
    row.className = 'trade-row';
    const res = t.result || 'pending';
    const pnlStr = res === 'pending' ? '‚Äî' : (t.pnl >= 0 ? '+' : '') + '$' + (t.pnl||0).toFixed(2);
    const pnlClass = res === 'win' ? 'green' : res === 'loss' ? 'red' : '';
    row.innerHTML = `
      <span class="trade-market" title="${t.ticker}">${t.market || t.ticker}</span>
      <span style="font-family:var(--mono);font-size:12px">$${(t.cost||0).toFixed(2)}</span>
      <span><span class="trade-tag ${res}">${res.toUpperCase()}</span></span>
      <span class="trade-pnl ${pnlClass}">${pnlStr}</span>
    `;
    list.appendChild(row);
  });
}

// ===== SYNC =====
function openSyncModal() { document.getElementById('syncModal').classList.add('show'); }
function closeSyncModal() { document.getElementById('syncModal').classList.remove('show'); }

function importTrades() {
  const raw = document.getElementById('syncInput').value.trim();
  try {
    const data = JSON.parse(raw);
    const arr = Array.isArray(data) ? data : data.trades || [];
    if (!arr.length) { alert('No trades found in data'); return; }
    // Merge ‚Äî normalize fields
    const normalized = arr.map((t, i) => ({
      id: t.id || i+1,
      ticker: t.ticker || t.market_id || '',
      market: t.title || t.market || t.ticker || '',
      side: t.side || 'YES',
      price: t.price || t.entry_price || 0,
      qty: t.quantity || t.qty || 0,
      cost: t.cost || (t.price * t.quantity) || 0,
      potential: t.potential_profit || t.potential || 0,
      edge: t.edge || 0,
      confidence: t.confidence || 0,
      ts: t.timestamp || t.ts || new Date().toISOString(),
      result: t.result || 'pending',
      pnl: t.pnl || 0,
    }));
    trades = normalized;
    saveTrades();
    renderAll();
    closeSyncModal();
    document.getElementById('syncInput').value = '';
  } catch(e) {
    alert('Invalid JSON: ' + e.message);
  }
}

function exportData() {
  const blob = new Blob([JSON.stringify(trades, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'kalshi-trades.json';
  a.click();
}

function clearData() {
  if (confirm('Clear all trade data? This cannot be undone.')) {
    trades = [];
    saveTrades();
    renderAll();
  }
}

// ===== SETTINGS =====
function updateSlider(id, prefix) {
  const el = document.getElementById(id);
  document.getElementById(id + 'Val').textContent = prefix + el.value + (prefix === '%' ? '' : prefix === '$' ? '' : '');
  if (prefix === '$') document.getElementById(id + 'Val').textContent = '$' + el.value;
  if (prefix === '%') document.getElementById(id + 'Val').textContent = el.value + '%';
  if (prefix === '') document.getElementById(id + 'Val').textContent = el.value;
  generateConfig();
}

function updateKillSwitch() {
  const on = document.getElementById('botEnabled').checked;
  const sw = document.getElementById('killSwitch');
  sw.className = 'kill-switch ' + (on ? 'on' : 'off');
  document.getElementById('killStatus').textContent = on ? 'Trading active' : 'TRADING PAUSED';
  generateConfig();
}

function generateConfig() {
  const config = {
    bot_enabled: document.getElementById('botEnabled').checked,
    daily_spend_limit: parseInt(document.getElementById('dailyLimit').value),
    per_trade_amount: parseInt(document.getElementById('perTrade').value),
    min_confidence: parseInt(document.getElementById('minConf').value),
    min_edge_pct: parseInt(document.getElementById('minEdge').value),
    max_trades_per_day: parseInt(document.getElementById('maxTrades').value),
    markets_enabled: {
      weather: document.getElementById('mktWeather').checked,
      politics: document.getElementById('mktPolitics').checked,
      crypto: document.getElementById('mktCrypto').checked,
      finance: document.getElementById('mktFinance').checked,
    },
    conflict_detection: document.getElementById('conflictDetect').checked,
    duplicate_prevention: document.getElementById('dupePrevent').checked,
    updated_at: new Date().toISOString(),
    updated_by: "dashboard"
  };
  document.getElementById('configOutput').textContent = JSON.stringify(config, null, 2);
}

function copyConfig() {
  const text = document.getElementById('configOutput').textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = event.target;
    btn.textContent = '‚úì Copied!';
    setTimeout(() => btn.textContent = 'üìã Copy Config', 1500);
  });
}

function copySshCommand() {
  const config = document.getElementById('configOutput').textContent;
  const escaped = config.replace(/'/g, "'\\''");
  const cmd = `ssh root@174.138.84.53 'cat > /root/polymarket-ai-bot/config.json << ENDCFG\n${config}\nENDCFG'`;
  navigator.clipboard.writeText(cmd).then(() => {
    const btn = event.target;
    btn.textContent = '‚úì Copied!';
    setTimeout(() => btn.textContent = 'üìã Copy SSH Push Command', 1500);
  });
}

// ===== INIT =====
function renderAll() {
  renderOverview();
  renderTrades();
  generateConfig();
}

renderAll();
window.addEventListener('resize', () => renderOverview());
</script>
</body>
</html>
